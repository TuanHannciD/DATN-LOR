@using System.Linq
@{
    ViewData["Title"] = "DonHang";
    Layout = "~/Views/Shared/_LayoutCart.cshtml";
}

@model List<AuthDemo.Models.ViewModels.HoaDonKHVM>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .order-card {
        border: 1px solid #E5E7EB;
        border-radius: 1rem;
        background: white;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
        transform: translateY(0);
    }

        .order-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(-0.25rem);
        }

    .order-header {
        background: linear-gradient(to right, #F9FAFB, #F3F4F6);
        padding: 1.5rem 1.5rem;
        border-bottom: 1px solid #E5E7EB;
        font-family: 'Georgia', serif;
        font-weight: 800; /* Tăng độ đậm lên từ 700 thành 800 */
        font-size: 1.25rem; /* Kích thước chữ giữ nguyên */
        color: #1F2937;
    }

    .product-item {
        display: flex;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px dashed #E5E7EB;
    }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-item:hover {
            background: #F3F4F6;
            transition: background 0.3s ease;
        }

    .order-status-tabs {
        border-bottom: 2px solid #E5E7EB;
        margin-bottom: 2rem;
        position: relative;
    }

        .order-status-tabs .nav-link {
            padding: 1rem 1.5rem;
            font-size: 1.125rem;
            font-weight: 700; /* Tăng độ đậm lên từ 600 thành 700 */
            color: #4B5563;
            transition: color 0.3s ease;
            position: relative;
            display: inline-block;
        }

            .order-status-tabs .nav-link:hover {
                color: #9333EA;
            }

            .order-status-tabs .nav-link.active {
                color: #3B82F6;
                font-weight: 900; /* Tăng độ đậm lên từ 700 thành 900 khi active */
            }

                .order-status-tabs .nav-link.active::after {
                    content: '';
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    height: 0.25rem;
                    width: 100%;
                    background: linear-gradient(to right, #3B82F6, #9333EA);
                    border-top-left-radius: 0.125rem;
                    border-top-right-radius: 0.125rem;
                    transform: translateY(0);
                    transition: transform 0.3s ease;
                }

    .dream-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.5), transparent);
        border-radius: 1rem;
        opacity: 0.5;
        pointer-events: none;
    }

    .dream-shadow {
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.1);
    }
</style>

<div class="container mx-auto px-6 mt-10 relative">
    <!-- Enhanced Dream Elements for background effect -->
    <div class="dream-element" style="width: 250px; height: 250px; background: #FFE8E8; top: -60px; left: -60px; animation: dreamFloat 18s ease-in-out infinite;"></div>
    <div class="dream-element" style="width: 180px; height: 180px; background: #E8F4FF; bottom: -40px; right: -40px; animation: dreamFloat 20s ease-in-out infinite reverse;"></div>

    <h2 class="text-3xl font-serif font-extrabold text-primary-900 mb-6 bg-gradient-to-r from-accent-400 to-accent-600 bg-clip-text text-transparent">Đơn Hàng</h2>

    <ul class="order-status-tabs flex space-x-4" id="orderTab" role="tablist">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tatca" data-status="">Tất cả</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#cho-xac-nhan" data-status="0">Chờ xác nhận</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#cho-van-chuyen" data-status="1">Chờ vận chuyển</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#hoan-thanh" data-status="3">Hoàn thành</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#da-huy" data-status="5">Đã hủy</a></li>
    </ul>

    <div class="tab-content mt-6 relative" id="orderContent">
        <!-- Đơn hàng sẽ được load vào đây bằng Ajax -->
        <div class="dream-overlay"></div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            function loadOrders(status) {
                $.ajax({
                    url: '/HoaDon/LayDonHangTheoTrangThai',
                    type: 'GET',
                    data: { trangThai: status },
                    success: function (data) {
                        $('#orderContent').html(data);
                    },
                    error: function () {
                        $('#orderContent').html('<p class="text-red-500 font-medium">Lỗi khi tải đơn hàng. Vui lòng thử lại sau!</p>');
                    }
                });
            }

            // Tải mặc định "Tất cả"
            loadOrders('');

            // Khi bấm tab
            $('.order-status-tabs .nav-link').on('click', function (e) {
                e.preventDefault(); // Ngăn điều hướng mặc định của thẻ <a>

                // Xóa .active ở tất cả các tab
                $('.order-status-tabs .nav-link').removeClass('active');

                // Gán .active cho tab vừa được click
                $(this).addClass('active');

                // Gọi hàm xử lý Ajax
                var status = $(this).data('status');
                loadOrders(status);
            });
        });
    </script>
}